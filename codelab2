1.

CREATE DATABASE QLDA1
USE QLDA1
GO
Create table NHANVIEN
(
HONV nvarchar(15) not null,
TENLOT nvarchar(15) not null,
TENNV nvarchar(15) not null,
MANV nvarchar(9) not null,
NGSINH smalldatetime not null,
DCHI nvarchar(30) not null,
PHAI nvarchar(3) not null,
LUONG float  not null,
MA_NQL nvarchar(9) null,
PHG int not null,
 CONSTRAINT [PK_NhanVien] PRIMARY KEY CLUSTERED 
(
	[MANV] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
Create table PHONGBAN
(

TENPHG nvarchar(15) not null,
MAPHG int not null,
TRPHG nvarchar(9) not null,
NG_NHANCHUC smalldatetime not null,
 CONSTRAINT [PK_PhongBan] PRIMARY KEY CLUSTERED 
(
	[MAPHG] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
GO
Create table CONGVIEC
(
MADA int not null,
STT int not null,
TEN_CONG_VIEC nvarchar(50) not null,
 CONSTRAINT [PK_CongViec] PRIMARY KEY CLUSTERED 
(
	[MADA] ASC,
	[STT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create table DEAN
(

TENDA nvarchar(15) not null,
MADA int not null,
DDIEM_DA nvarchar(15) not null,
PHONG int not null,
 CONSTRAINT [PK_DeAn] PRIMARY KEY CLUSTERED 
(
	[MADA] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create table DIADIEM_PHG
(

MAPHG int not null,
DIADIEM nvarchar(15) not null,
 CONSTRAINT [PK_DiaDiemPhong] PRIMARY KEY CLUSTERED 
(
	[MAPHG] ASC,
	[DIADIEM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create table PHANCONG
(
MA_NVIEN nvarchar(9) ,
MADA int not null,
STT int not null,
THOIGIAN float not null
 CONSTRAINT [PK_PhanCong] PRIMARY KEY CLUSTERED 
(
	[MA_NVIEN] ASC,
	[MADA] ASC,
	[STT] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create table THANNHAN
(
MA_NVIEN nvarchar(9) not null,
TENTN nvarchar(15) not null,
PHAI nvarchar(3) not null,
NGSINH smalldatetime not null,
QUANHE nvarchar(15) not null,
 CONSTRAINT [PK_ThanNhan] PRIMARY KEY CLUSTERED 
(
	[MA_NVIEN] ASC,
	[TENTN] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
insert CONGVIEC (MADA,STT,TEN_CONG_VIEC) values (1, 1, N'Thi?t k? s?n ph?m X')
insert CONGVIEC (MADA,STT,TEN_CONG_VIEC) values (1, 2, N'Th? nghi?m s?n ph?m X')

insert CONGVIEC (MADA,STT,TEN_CONG_VIEC) values (2, 1, N'S?n xu?t s?n ph?m Y')
insert CONGVIEC (MADA,STT,TEN_CONG_VIEC) values (2, 2, N'Qu?ng cáo s?n ph?m Y')
insert CONGVIEC (MADA,STT,TEN_CONG_VIEC) values (3, 1, N'Khuy?n mãi s?n ph?m Z')
insert CONGVIEC (MADA,STT,TEN_CONG_VIEC) values (10, 1, N'Tin h?c hóa phòng nhân s?')
insert CONGVIEC (MADA,STT,TEN_CONG_VIEC) values (10, 2, N'Tin h?c hóa phòng kinh doanh')
insert CONGVIEC (MADA,STT,TEN_CONG_VIEC) values (20, 1, N'L?p ??t cáp quang')
insert CONGVIEC (MADA,STT,TEN_CONG_VIEC) values (30, 1, N'?ào t?o nhân viên Marketing')
insert CONGVIEC (MADA,STT,TEN_CONG_VIEC) values (30, 2, N'?ào t?o chuyên viên thi?t k?')
insert DEAN (TENDA,MADA,DDIEM_DA,PHONG) values (N'S?n Ph?m x', 1, N'V?ng Tàu', 5)
insert DEAN (TENDA,MADA,DDIEM_DA,PHONG) values (N'S?n Ph?m Y', 2, N'Nha Trang', 5)
insert DEAN (TENDA,MADA,DDIEM_DA,PHONG) values (N'S?n Ph?m Z', 3, N'TP HCM', 5)
insert DEAN (TENDA,MADA,DDIEM_DA,PHONG) values (N'Tin H?c Hóa', 10, N'Hà N?i', 4)
insert DEAN (TENDA,MADA,DDIEM_DA,PHONG) values (N'Cáp quang', 20, N'TP HCM', 1)
insert DEAN (TENDA,MADA,DDIEM_DA,PHONG) values (N'?ào t?o', 30, N'Hà N?i', 4)
insert DIADIEM_PHG (MAPHG,DIADIEM) values (1, N'TP HCM')
insert DIADIEM_PHG (MAPHG,DIADIEM) values (4, N'Hà N?i')
insert DIADIEM_PHG (MAPHG,DIADIEM) values (5, N'TAU')
insert DIADIEM_PHG (MAPHG,DIADIEM) values (5, N'Nha Trang')
insert DIADIEM_PHG (MAPHG,DIADIEM) values (5, N'TP HCM')
insert NHANVIEN (HONV,TENLOT,TENNV,MANV,NGSINH,DCHI,PHAI,LUONG,MA_NQL,PHG) values (N'?inh ',N'Bá ',N'Tiên ',N'009',CAST(N'1960-02-11T00:00:00.000' AS DateTime),N'119 C?ng Qu?nh,Tp HCM',N'Nam',N'30000',N'005',5)
insert NHANVIEN (HONV,TENLOT,TENNV,MANV,NGSINH,DCHI,PHAI,LUONG,MA_NQL,PHG) values (N'Nguy? n',N'Thanh ',N'Tùng',N'005',CAST(N'1962-08-20T00:00:00.000' AS DateTime),N'222 Nguy?n V?n C?,Tp HCM',N'Nam',N'40000',N'006',5)
insert NHANVIEN (HONV,TENLOT,TENNV,MANV,NGSINH,DCHI,PHAI,LUONG,MA_NQL,PHG) values (N'Bùi ',N'Ng?c ',N'H?ng',N'007',CAST(N'1954-03-11T00:00:00.000' AS DateTime),N'332 Nguy?n Thái H?c,Tp HCM',N'Nam',N'25000',N'001',4)
insert NHANVIEN (HONV,TENLOT,TENNV,MANV,NGSINH,DCHI,PHAI,LUONG,MA_NQL,PHG) values (N'Lê ',N'Qu?nh ',N'Nh? ',N'001',CAST(N'1967-02-01T00:00:00.000' AS DateTime),N'291 H? V?n Khuê,Tp HCM',N'N?',N'43000',N'006',4)
insert NHANVIEN (HONV,TENLOT,TENNV,MANV,NGSINH,DCHI,PHAI,LUONG,MA_NQL,PHG) values (N'Nguy?n',N'M?nh',N'Hùng',N'004',CAST(N'1967-03-04T00:00:00.000' AS DateTime),N'95 Bà R?a, V?ng Tàu',N'Nam',N'38000',N'005',5)
insert NHANVIEN (HONV,TENLOT,TENNV,MANV,NGSINH,DCHI,PHAI,LUONG,MA_NQL,PHG) values (N'Tr?n',N'Thanh',N'Tâm',N'003',CAST(N'1957-05-04T00:00:00.000' AS DateTime),N'34 Mai Th? L?, Tp HCM',N'Nam',N'25000',N'005',5)
insert NHANVIEN (HONV,TENLOT,TENNV,MANV,NGSINH,DCHI,PHAI,LUONG,MA_NQL,PHG) values (N'Tr?n',N'H?ng',N'Quang',N'008',CAST(N'1967-09-01T00:00:00.000' AS DateTime),N'80 Lê H?ng Phong, Tp HCM',N'Nam',N'25000',N'001',4)

insert NHANVIEN (HONV,TENLOT,TENNV,MANV,NGSINH,DCHI,PHAI,LUONG,PHG) values (N'Ph?m',N'V?n',N'Vinh',N'006',CAST(N'1965-01-01T00:00:00.000' AS DateTime),N'56 Tr?ng V??ng. Hà N?i',N'N?',N'55000',5)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'009', 1, 1, 32)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'009', 2, 2, 8)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'004', 3, 1, 40)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'003', 1, 2, 20.0)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'003', 2, 1, 20.0)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'008', 10, 1, 35)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'008', 30, 2, 5)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'001', 30, 1, 20)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'001', 20, 1, 15)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'006', 20, 1, 30)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'005', 3, 1, 10)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'005', 10, 2, 10)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'005', 20, 1, 10)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'007', 30, 2, 30)
insert PHANCONG (MA_NVIEN,MADA,STT,THOIGIAN) values (N'007', 10, 2, 10)
insert PHONGBAN (TENPHG,MAPHG,TRPHG,NG_NHANCHUC) values (N'Nghiên c?u', 5, N'005', CAST(N'1978-05-22' AS Date))
insert PHONGBAN (TENPHG,MAPHG,TRPHG,NG_NHANCHUC) values (N'?i?u hành', 4, N'008', CAST(N'1985-01-01' AS Date))
insert PHONGBAN (TENPHG,MAPHG,TRPHG,NG_NHANCHUC) values (N'Qu?n lý', 1, N'006', CAST(N'1971-06-19' AS Date))
insert THANNHAN (MA_NVIEN,TENTN,PHAI,NGSINH,QUANHE) values (N'005', N'Trinh', N'N?', CAST(N'1976-04-05' AS Date), N'Con gái')
insert THANNHAN (MA_NVIEN,TENTN,PHAI,NGSINH,QUANHE) values (N'005', N'Khang', N'Nam', CAST(N'1973-10-25' AS Date), N'Con trai')
insert THANNHAN (MA_NVIEN,TENTN,PHAI,NGSINH,QUANHE) values (N'005', N'Ph??ng', N'N?', CAST(N'1948-05-03' AS Date), N'V? ch?ng')
insert THANNHAN (MA_NVIEN,TENTN,PHAI,NGSINH,QUANHE) values (N'001', N'Minh', N'Nam', CAST(N'1932-02-29' AS Date), N'V? Ch?ng')
insert THANNHAN (MA_NVIEN,TENTN,PHAI,NGSINH,QUANHE) values (N'009', N'Ti?n ', N'Nam', CAST(N'1978-01-01' AS Date), N'Con Trai')
insert THANNHAN (MA_NVIEN,TENTN,PHAI,NGSINH,QUANHE) values (N'009', N'Châu ', N'N?', CAST(N'1978-12-30' AS Date), N'Con Gái')
insert THANNHAN (MA_NVIEN,TENTN,PHAI,NGSINH,QUANHE) values (N'009', N'Ph??ng', N'N?', CAST(N'1957-05-05' AS Date), N'V? Ch?ng')
ALTER TABLE [dbo].[CONGVIEC]  WITH CHECK ADD  CONSTRAINT [FK_DeAn_CongViec] FOREIGN KEY([MADA])
REFERENCES [dbo].[DEAN] ([MADA])
GO
ALTER TABLE [dbo].[CONGVIEC] CHECK CONSTRAINT [FK_DeAn_CongViec]
GO
ALTER TABLE [dbo].[DEAN]  WITH CHECK ADD  CONSTRAINT [FK_PhongBan_DeAn] FOREIGN KEY([PHONG])
REFERENCES [dbo].[PHONGBAN] ([MAPHG])
GO
ALTER TABLE [dbo].[DEAN] CHECK CONSTRAINT [FK_PhongBan_DeAn]
GO

ALTER TABLE [dbo].[DIADIEM_PHG]  WITH CHECK ADD  CONSTRAINT [FK_PhongBan_DiaDiemPhg] FOREIGN KEY([MAPHG])
REFERENCES [dbo].[PHONGBAN] ([MAPHG])
GO
ALTER TABLE [dbo].[DIADIEM_PHG] CHECK CONSTRAINT [FK_PhongBan_DiaDiemPhg]
GO
ALTER TABLE [dbo].[NHANVIEN]  WITH CHECK ADD  CONSTRAINT [FK_NhanVien_NhanVien] FOREIGN KEY([MA_NQL])
REFERENCES [dbo].[NHANVIEN] ([MANV])
GO
ALTER TABLE [dbo].[NHANVIEN] CHECK CONSTRAINT [FK_NhanVien_NhanVien]
GO
ALTER TABLE [dbo].[NHANVIEN]  WITH CHECK ADD  CONSTRAINT [FK_PhongBan_NhanVien] FOREIGN KEY([PHG])
REFERENCES [dbo].[PHONGBAN] ([MAPHG])
GO
ALTER TABLE [dbo].[NHANVIEN] CHECK CONSTRAINT [FK_PhongBan_NhanVien]
GO
ALTER TABLE [dbo].[PHANCONG]  WITH CHECK ADD  CONSTRAINT [FK_CongViec_PhanCong] FOREIGN KEY([MADA], [STT])
REFERENCES [dbo].[CONGVIEC] ([MADA], [STT])
GO
ALTER TABLE [dbo].[PHANCONG] CHECK CONSTRAINT [FK_CongViec_PhanCong]
GO
ALTER TABLE [dbo].[PHANCONG]  WITH CHECK ADD  CONSTRAINT [FK_NhanVien_PhanCong] FOREIGN KEY([MA_NVIEN])
REFERENCES [dbo].[NHANVIEN] ([MANV])
GO
ALTER TABLE [dbo].[PHANCONG] CHECK CONSTRAINT [FK_NhanVien_PhanCong]
GO
ALTER TABLE [dbo].[PHONGBAN]  WITH CHECK ADD  CONSTRAINT [FK_NhanVien_PhongBan] FOREIGN KEY([TRPHG])
REFERENCES [dbo].[NHANVIEN] ([MANV])
GO
ALTER TABLE [dbo].[PHONGBAN] CHECK CONSTRAINT [FK_NhanVien_PhongBan]
GO
ALTER TABLE [dbo].[THANNHAN]  WITH CHECK ADD  CONSTRAINT [FK_NhanVien_ThanNhan] FOREIGN KEY([MA_NVIEN])
REFERENCES [dbo].[NHANVIEN] ([MANV])
GO
ALTER TABLE [dbo].[THANNHAN] CHECK CONSTRAINT [FK_NhanVien_ThanNhan]



2.1
lựa chọn *
TỪ NHÂNVIÊN
WHERE LUONG=(SELECT MAX(LUONG) FROM NHANVIEN);

2.2 
SELECT (NHANVIEN.HONV+' '+NHANVIEN.TENLOT+' '+NHANVIEN.TENNV)
AS 'họ tên nhân viên có mức lương trên mức lương trung bình của phòng "nghiêm cứu" '
from [NHANVIEN]
WHERE PHG=5 AND NHANVIEN.LUONG>(SELECT AVG(NHANVIEN.LUONG) FROM NHANVIEN);

2.3
SELECT PHONGBAN.TNPHG, COUT(NHANVIEN.MANV) Á N'Số lượng nhân viên'
FROM NHANVIEN, PHONGBAN
WHERE NHANVIEN.PHG=PHONGBAN.MAPHG
GROUP BY PHONGBAN.TENPHG
HAVING AVG(NHANVIEN.LUONG)>30000

2.4
SELECT PHONGBAN.TENPHG, COUNT(DEAN.PHONG) AS 'Số lượng đề án'
FROM PHONGBAN, DEAN
WHERE PHONGBAN.MẠHG = DEAN.PHONG
GROUP BY PHONGBAN.
